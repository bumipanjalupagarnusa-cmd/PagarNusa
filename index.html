<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Form Pendaftaran — Aplikasi KTA Pagar Nusa</title>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      :root {
        --primary-color: #0d3b66;
        --secondary-color: #1f7a8c;
        --accent-color: #1ab8c0;
        --light-color: #f6f8fb;
        --dark-color: #14213b;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --error-color: #dc3545;
        --text-color: #333;
        --border-color: #e0e0e0;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--light-color);
        color: var(--text-color);
        line-height: 1.6;
        padding-bottom: 60px; /* Space for footer */
      }

      /* Splash Screen */
      #splash {
        background-color: var(--dark-color);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        z-index: 9999;
        transition: opacity 0.5s ease;
      }

      #splash .logo {
        width: 120px;
        height: 120px;
        margin-bottom: 20px;
        animation: pulse 1.5s infinite ease-in-out;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .loading-text {
        color: white;
        font-size: 18px;
        font-weight: 500;
        margin-top: 10px;
      }

      .dots::after {
        content: "";
        display: inline-block;
        width: 1em;
        text-align: left;
        animation: dots 1s steps(3, end) infinite;
      }

      @keyframes dots {
        0%,
        20% {
          content: "";
        }
        40% {
          content: ".";
        }
        60% {
          content: "..";
        }
        80%,
        100% {
          content: "...";
        }
      }

      /* Header */
      .main-header {
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        padding: 15px 20px;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: var(--shadow);
      }

      .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .brand .logo {
        width: 55px;
        height: 55px;
        object-fit: contain;
      }

      .brand-text {
        display: flex;
        flex-direction: column;
      }

      .brand-title {
        font-weight: 700;
        font-size: 18px;
      }

      .brand-subtitle {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.8);
      }

      nav {
        display: flex;
        gap: 10px;
      }

      nav button {
        background-color: transparent;
        border: none;
        color: white;
        font-weight: 500;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
      }

      nav button:hover {
        background-color: var(--accent-color);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      /* Home Section */
      .home-section {
        padding: 40px 20px;
        text-align: center;
        max-width: 1000px;
        margin: 0 auto;
      }

      .home-logo {
        margin-bottom: 20px;
      }

      .home-logo img {
        width: 120px;
        height: 120px;
        object-fit: contain;
      }

      .home-section h1 {
        font-size: 28px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 15px;
      }

      .home-section p {
        font-size: 16px;
        margin-bottom: 30px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
      }

      .registration-flow {
        margin: 40px auto;
      }

      .registration-flow h2 {
        color: var(--primary-color);
        margin-bottom: 20px;
      }

      .flow-slider {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        padding: 10px 5px;
        scroll-behavior: smooth;
      }

      .flow-slider::-webkit-scrollbar {
        height: 6px;
      }

      .flow-slider::-webkit-scrollbar-thumb {
        background-color: var(--accent-color);
        border-radius: 3px;
      }

      .flow-step {
        min-width: 180px;
        flex: 0 0 auto;
        background: linear-gradient(
          135deg,
          var(--accent-color),
          var(--secondary-color)
        );
        color: white;
        padding: 15px;
        border-radius: 10px;
        text-align: center;
        font-weight: 600;
        box-shadow: var(--shadow);
        opacity: 0;
        transform: translateY(10px);
        animation: fadeInUp 0.6s ease forwards;
      }

      .flow-step:nth-child(1) {
        animation-delay: 0s;
      }
      .flow-step:nth-child(2) {
        animation-delay: 0.1s;
      }
      .flow-step:nth-child(3) {
        animation-delay: 0.2s;
      }
      .flow-step:nth-child(4) {
        animation-delay: 0.3s;
      }
      .flow-step:nth-child(5) {
        animation-delay: 0.4s;
      }

      .step-icon {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin: 0 auto 10px;
      }

      @keyframes fadeInUp {
        0% {
          opacity: 0;
          transform: translateY(10px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Form Section */
      .form-section {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
      }

      .card {
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow);
        padding: 30px;
        margin-bottom: 20px;
      }

      .form-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
      }

      .form-header img {
        width: 60px;
        height: 60px;
        object-fit: contain;
      }

      .form-header h1 {
        font-size: 24px;
        color: var(--primary-color);
      }

      /* Steps */
      .steps {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin: 30px 0;
      }

      .step {
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 600;
        font-size: 14px;
        color: #666;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
      }

      .step.active {
        color: var(--primary-color);
      }

      .step-circle {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
        background-color: #ccc;
        color: white;
        border-radius: 50%;
        font-size: 14px;
        font-weight: bold;
        transition: var(--transition);
        position: relative;
      }

      .step.active .step-circle {
        background-color: var(--primary-color);
      }

      /* NEW: Completed step style */
      .step.completed .step-circle {
        background-color: var(--success-color);
      }

      .step.completed .step-circle::after {
        content: "✓";
        position: absolute;
        color: white;
        font-size: 16px;
        font-weight: bold;
      }

      .step.completed .step-circle span {
        display: none; /* Hide the number when checkmark is shown */
      }

      .step-line {
        width: 40px;
        height: 2px;
        background: #ccc;
        transition: var(--transition);
      }

      .step.active + .step-line {
        background: var(--primary-color);
      }

      /* Form Elements */
      .form-step {
        display: none;
      }

      .form-step.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        font-size: 14px;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        font-family: "Poppins", sans-serif;
        font-size: 14px;
        transition: var(--transition);
      }

      input:focus,
      select:focus,
      textarea:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(13, 59, 102, 0.1);
      }

      input.error,
      select.error,
      textarea.error {
        border-color: var(--error-color);
      }

      .help-text {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      .error-text {
        font-size: 12px;
        color: var(--error-color);
        margin-top: 5px;
        display: none; /* Hidden by default */
      }

      .radio-group {
        margin-bottom: 20px;
      }

      .radio-group label {
        font-weight: 600;
        margin-bottom: 10px;
      }

      .radio-option {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
      }

      .radio-option input[type="radio"] {
        width: auto;
        margin-right: 10px;
      }

      .checkbox-group {
        margin-bottom: 20px;
      }

      .custom-checkbox {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        cursor: pointer;
      }

      .custom-checkbox input[type="checkbox"] {
        width: auto;
        margin-right: 5px;
      }

      .institution-group {
        background-color: #f9f9f9;
        border-left: 3px solid var(--primary-color);
        padding: 15px;
        border-radius: 0 8px 8px 0;
        margin-top: 10px;
        display: none;
      }

      .institution-group.show {
        display: block;
        animation: slideDown 0.3s ease;
      }

      @keyframes slideDown {
        from {
          max-height: 0;
          opacity: 0;
        }
        to {
          max-height: 500px;
          opacity: 1;
        }
      }

      .file-upload {
        margin-bottom: 20px;
      }

      .file-preview {
        margin-top: 10px;
        max-width: 150px;
        border-radius: 8px;
        overflow: hidden;
      }

      .file-preview img {
        width: 100%;
        height: auto;
        display: block;
      }

      /* Buttons */
      .actions {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        font-size: 14px;
      }

      .btn-primary {
        background-color: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .btn-secondary {
        background-color: #e5eaf1;
        color: var(--text-color);
      }

      .btn-secondary:hover {
        background-color: #d5d9e0;
      }

      /* Footer */
      .contact-footer {
        background-color: var(--primary-color);
        color: white;
        padding: 15px 0;
        text-align: center;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        font-size: 14px;
      }

      .contact-footer a {
        color: white;
        text-decoration: none;
        margin: 0 5px;
      }

      .contact-footer a:hover {
        text-decoration: underline;
      }

      /* Notification */
      .notification-container {
        position: fixed;
        top: 80px;
        right: 20px;
        z-index: 1000;
      }

      .notification {
        background: white;
        border-radius: 8px;
        padding: 15px 20px;
        margin-bottom: 10px;
        box-shadow: var(--shadow);
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 300px;
        animation: slideInRight 0.3s ease;
      }

      @keyframes slideInRight {
        from {
          transform: translateX(100%);
        }
        to {
          transform: translateX(0);
        }
      }

      .notification.success {
        border-left: 4px solid var(--success-color);
      }

      .notification.error {
        border-left: 4px solid var(--error-color);
      }

      .notification.warning {
        border-left: 4px solid var(--warning-color);
      }

      .notification.info {
        border-left: 4px solid var(--primary-color);
      }

      .notification i {
        font-size: 18px;
      }

      .notification.success i {
        color: var(--success-color);
      }

      .notification.error i {
        color: var(--error-color);
      }

      .notification.warning i {
        color: var(--warning-color);
      }

      .notification.info i {
        color: var(--primary-color);
      }

      .notification-close {
        margin-left: auto;
        cursor: pointer;
        color: #999;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .header-container {
          flex-direction: column;
          gap: 15px;
        }

        .brand-title {
          font-size: 16px;
          text-align: center;
        }

        .brand-subtitle {
          font-size: 12px;
          text-align: center;
        }

        .steps {
          flex-wrap: wrap;
        }

        .step-line {
          display: none;
        }

        .form-section {
          padding: 15px;
        }

        .card {
          padding: 20px;
        }

        .actions {
          flex-direction: column;
          gap: 10px;
        }

        .btn {
          width: 100%;
        }

        .notification-container {
          right: 10px;
          left: 10px;
        }

        .notification {
          min-width: auto;
        }
      }
    </style>
  </head>
  <body>
    <!-- Splash Screen -->
    <div id="splash">
      <img
        src="https://picsum.photos/seed/logo1/120/120.jpg"
        alt="Logo Pagar Nusa"
        class="logo"
      />
      <h1 class="loading-text">Loading<span class="dots"></span></h1>
    </div>

    <!-- Header -->
    <header class="main-header">
      <div class="header-container">
        <div class="brand">
          <img
            src="https://picsum.photos/seed/logo1/55/55.jpg"
            alt="Logo Pagar Nusa"
            class="logo"
          />
          <div class="brand-text">
            <div class="brand-title">Pagar Nusa — Aplikasi Pembuatan KTA</div>
            <div class="brand-subtitle">Pendaftaran & Verifikasi Anggota</div>
          </div>
        </div>
        <nav>
          <button onclick="showHome()">
            <i class="fas fa-home"></i> Beranda
          </button>
          <button onclick="showForm()">
            <i class="fas fa-file-alt"></i> Pendaftaran
          </button>
        </nav>
      </div>
    </header>

    <!-- Home Section -->
    <section id="home" class="home-section">
      <div class="home-logo">
        <img
          src="https://picsum.photos/seed/logo1/120/120.jpg"
          alt="Logo Pagar Nusa"
        />
      </div>
      <h1>Selamat Datang di Aplikasi KTA Pagar Nusa BUMI PANJALU</h1>
      <p>
        Dengan aplikasi ini, kamu dapat dengan mudah melakukan
        <b>pendaftaran, pengelolaan, dan verifikasi anggota resmi</b> Pagar Nusa
        secara digital.
      </p>

      <div class="registration-flow">
        <h2>Tata Cara Pengisian Pendaftaran</h2>
        <div class="flow-slider">
          <div class="flow-step">
            <div class="step-icon">1</div>
            Buka halaman <b>Pendaftaran</b>
          </div>
          <div class="flow-step">
            <div class="step-icon">2</div>
            Isi data pribadi lengkap
          </div>
          <div class="flow-step">
            <div class="step-icon">3</div>
            Unggah foto & dokumen
          </div>
          <div class="flow-step">
            <div class="step-icon">4</div>
            Periksa data & klik <b>Submit</b>
          </div>
          <div class="flow-step">
            <div class="step-icon">5</div>
            Tunggu verifikasi admin
          </div>
        </div>
      </div>

      <button class="btn btn-primary" onclick="showForm()">
        Mulai Pendaftaran
      </button>
    </section>

    <!-- Form Section -->
    <section id="formSection" class="form-section" style="display: none">
      <div class="card">
        <div class="form-header">
          <img
            src="https://picsum.photos/seed/logo1/60/60.jpg"
            alt="Logo Pagar Nusa"
          />
          <h1>Form Pendaftaran</h1>
        </div>

        <div class="steps">
          <div id="nav1" class="step" onclick="goToStep(1)">
            <span class="step-circle"><span>1</span></span> Langkah 1
          </div>
          <div class="step-line" id="line1"></div>
          <div id="nav2" class="step" onclick="goToStep(2)">
            <span class="step-circle"><span>2</span></span> Langkah 2
          </div>
          <div class="step-line" id="line2"></div>
          <div id="nav3" class="step" onclick="goToStep(3)">
            <span class="step-circle"><span>3</span></span> Langkah 3
          </div>
          <div class="step-line" id="line3"></div>
          <div id="nav4" class="step" onclick="goToStep(4)">
            <span class="step-circle"><span>4</span></span> Langkah 4
          </div>
        </div>

        <form id="regForm" onsubmit="event.preventDefault(); submitForm()">
          <!-- Step 1: Data Pribadi -->
          <div id="step1" class="form-step">
            <div class="form-group">
              <label for="nik">NIK*</label>
              <input
                type="text"
                id="nik"
                required
                maxlength="16"
                pattern="[0-9]{16}"
              />
              <small class="help-text"
                >NIK sesuai KTP (Hanya angka & 16 digit)</small
              >
              <div class="error-text">NIK harus 16 digit angka</div>
            </div>

            <div class="form-group">
              <label for="email">Email*</label>
              <input type="email" id="email" required />
              <div class="error-text">Masukkan email yang valid</div>
            </div>

            <div class="form-group">
              <label for="nama">Nama Lengkap*</label>
              <input type="text" id="nama" required />
              <small class="help-text"
                >Nama tanpa gelar dan karakter khusus</small
              >
              <div class="error-text">Nama lengkap harus diisi</div>
            </div>

            <div class="form-group">
              <label for="tempat_lahir">Tempat Lahir*</label>
              <input type="text" id="tempat_lahir" required />
              <div class="error-text">Tempat lahir harus diisi</div>
            </div>

            <div class="form-group">
              <label for="tanggal_lahir">Tanggal Lahir*</label>
              <input type="date" id="tanggal_lahir" required />
              <div class="error-text">Tanggal lahir harus diisi</div>
            </div>

            <div class="form-group">
              <label for="jk">Jenis Kelamin*</label>
              <select id="jk" required>
                <option value="">Pilih...</option>
                <option value="Laki-laki">Laki-laki</option>
                <option value="Perempuan">Perempuan</option>
              </select>
              <div class="error-text">Pilih jenis kelamin</div>
            </div>

            <div class="form-group">
              <label for="hp">Nomor HP*</label>
              <input type="tel" id="hp" required pattern="[0-9]{10,13}" />
              <small class="help-text">Contoh: 081xxxXXXxxx</small>
              <div class="error-text">Nomor HP harus 10-13 digit angka</div>
            </div>

            <div class="actions">
              <div></div>
              <button
                type="button"
                class="btn btn-primary"
                onclick="nextStep(1)"
              >
                Selanjutnya <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Step 2: Data Latihan -->
          <div id="step2" class="form-step">
            <div class="form-group">
              <label for="nama_pelatih">Nama Pelatih</label>
              <input type="text" id="nama_pelatih" />
            </div>

            <div class="form-group">
              <label for="lokasi_latihan">Lokasi Latihan</label>
              <input type="text" id="lokasi_latihan" />
            </div>

            <div class="form-group">
              <label for="provinsi">Provinsi*</label>
              <select id="provinsi" onchange="populateKab()" required>
                <option value="">-- Pilih Provinsi --</option>
              </select>
              <div class="error-text">Pilih provinsi</div>
            </div>

            <div class="form-group">
              <label for="kabupaten">Kabupaten / Kota*</label>
              <select id="kabupaten" onchange="populateKec()" required>
                <option value="">-- Pilih Kabupaten/Kota --</option>
              </select>
              <div class="error-text">Pilih kabupaten/kota</div>
            </div>

            <div class="form-group">
              <label for="kecamatan">Kecamatan*</label>
              <select id="kecamatan" onchange="populateDesa()" required>
                <option value="">-- Pilih Kecamatan --</option>
              </select>
              <div class="error-text">Pilih kecamatan</div>
            </div>

            <div class="form-group">
              <label for="desa">Kelurahan/Desa*</label>
              <select id="desa" required>
                <option value="">-- Pilih Desa --</option>
              </select>
              <div class="error-text">Pilih kelurahan/desa</div>
            </div>

            <div class="radio-group">
              <label>Apakah Anda Pengurus?*</label>
              <div class="radio-option">
                <input
                  type="radio"
                  id="pengurus_ya"
                  name="pengurus"
                  value="ya"
                  required
                />
                <label for="pengurus_ya">Ya, Saya Pengurus</label>
              </div>
              <div class="radio-option">
                <input
                  type="radio"
                  id="pengurus_tidak"
                  name="pengurus"
                  value="tidak"
                  required
                />
                <label for="pengurus_tidak">Bukan Pengurus</label>
              </div>
              <div class="error-text">Pilih salah satu opsi</div>
            </div>

            <div class="actions">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="goToStep(1)"
              >
                <i class="fas fa-arrow-left"></i> Kembali
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="nextStep(2)"
              >
                Selanjutnya <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Step 3: Data Institusi -->
          <div id="step3" class="form-step">
            <div class="checkbox-group">
              <label class="custom-checkbox">
                <input
                  type="checkbox"
                  id="chk_padepokan"
                  onchange="toggleInstitution('padepokan')"
                />
                <span>Padepokan</span>
              </label>
              <div id="padepokanFields" class="institution-group">
                <div class="form-group">
                  <label for="nama_padepokan">Nama Perguruan</label>
                  <input type="text" id="nama_padepokan" />
                </div>
                <div class="form-group">
                  <label for="pengasuh_padepokan"
                    >Nama Pengasuh perguruan / padepokan</label
                  >
                  <input type="text" id="pengasuh_padepokan" />
                </div>
                <div class="form-group">
                  <label for="telepon_padepokan"
                    >Telepon perguruan / padepokan</label
                  >
                  <input type="tel" id="telepon_padepokan" />
                </div>
                <div class="form-group">
                  <label for="alamat_padepokan">Alamat</label>
                  <textarea id="alamat_padepokan" rows="3"></textarea>
                </div>
              </div>
            </div>

            <div class="checkbox-group">
              <label class="custom-checkbox">
                <input
                  type="checkbox"
                  id="chk_pesantren"
                  onchange="toggleInstitution('pesantren')"
                />
                <span>Pesantren</span>
              </label>
              <div id="pesantrenFields" class="institution-group">
                <div class="form-group">
                  <label for="nama_pesantren">Nama ponpes</label>
                  <input type="text" id="nama_pesantren" />
                </div>
                <div class="form-group">
                  <label for="pengasuh_pesantren">Pengasuh ponpes</label>
                  <input type="text" id="pengasuh_pesantren" />
                </div>
                <div class="form-group">
                  <label for="telepon_pesantren">Telepon ponpes</label>
                  <input type="tel" id="telepon_pesantren" />
                </div>
                <div class="form-group">
                  <label for="alamat_pesantren">Alamat</label>
                  <textarea id="alamat_pesantren" rows="3"></textarea>
                </div>
              </div>
            </div>

            <div class="checkbox-group">
              <label class="custom-checkbox">
                <input
                  type="checkbox"
                  id="chk_sekolah"
                  onchange="toggleInstitution('sekolah')"
                />
                <span>Sekolah</span>
              </label>
              <div id="sekolahFields" class="institution-group">
                <div class="form-group">
                  <label for="nama_sekolah">Nama Sekolah</label>
                  <input type="text" id="nama_sekolah" />
                </div>
                <div class="form-group">
                  <label for="alamat_sekolah">Alamat Sekolah</label>
                  <textarea id="alamat_sekolah" rows="3"></textarea>
                </div>
                <div class="form-group">
                  <label for="telepon_sekolah">Telepon Sekolah</label>
                  <input type="tel" id="telepon_sekolah" />
                </div>
              </div>
            </div>

            <div class="actions">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="goToStep(2)"
              >
                <i class="fas fa-arrow-left"></i> Kembali
              </button>
              <button
                type="button"
                class="btn btn-primary"
                onclick="nextStep(3)"
              >
                Selanjutnya <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </div>

          <!-- Step 4: Upload Dokumen -->
          <div id="step4" class="form-step">
            <div class="file-upload">
              <label for="foto">Upload Foto*</label>
              <input
                type="file"
                id="foto"
                accept="image/*"
                onchange="previewImage('foto', 'previewFoto')"
                required
              />
              <small class="help-text"
                >Upload Foto (max 10MB). Ketentuan: background merah, bersakral
                lengkap, perempuan wajib hijab, ukuran 3x4 max 5mb</small
              >
              <div id="previewFoto" class="file-preview"></div>
              <div class="error-text">Foto harus diunggah</div>
            </div>

            <div class="file-upload">
              <label for="ktp">Upload KTP/KK*</label>
              <input
                type="file"
                id="ktp"
                accept="image/*"
                onchange="previewImage('ktp', 'previewKTP')"
                required
              />
              <div id="previewKTP" class="file-preview"></div>
              <div class="error-text">KTP/KK harus diunggah</div>
            </div>

            <div class="actions">
              <button
                type="button"
                class="btn btn-secondary"
                onclick="goToStep(3)"
              >
                <i class="fas fa-arrow-left"></i> Kembali
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-check"></i> Kirim
              </button>
            </div>
          </div>
        </form>
      </div>
    </section>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Footer -->
    <footer class="contact-footer">
      Kontak Kami:
      <a href="mailto:bumipanjalupagarnusa@gmail.com"
        ><i class="fas fa-envelope"></i> bumipanjalupagarnusa@gmail.com</a
      >
      |
      <a href="tel:081217035139"><i class="fas fa-phone"></i> 0812-1703-5139</a>
    </footer>

    <script>
      // Data Wilayah
      const wilayah = {
        "Jawa Timur": {
          "Kabupaten Kediri": {
            Pare: [
              "bendo",
              "darungan",
              "gedangsewu",
              "pelem",
              "sambirejo",
              "sidorejo",
              "sumberbendo",
              "tertek",
              "tulungrejo",
            ],
            Plosoklaten: [
              "brenggolo",
              "donganti",
              "jarak",
              "kawedusan",
              "kayunan",
              "klanderan",
              "panjer",
              "plosokidul",
              "plosolor",
              "pranggang",
              "punjul",
              "sepawon",
              "sumberagung",
              "wonorejo trisulo",
            ],
            Kandat: [
              "cendono",
              "ringinsari",
              "tegalan",
              "ngletih",
              "sumberejo",
            ],
            KayenKidul: [
              "baye",
              "pandangan",
              "nanggungan",
              "semambung",
              "kayen kidul",
              "mukuh",
            ],
            Ngasem: [
              "tugurejo",
              "sumberejo",
              "gogorante",
              "doko",
              "ngasem",
              "sukorejo",
              "butuh",
              "tengger",
              "ngantru",
              "sambong",
              "dukohkidul",
            ],
            Badas: [
              "Badas",
              "canggu",
              "lamong",
              "bringin",
              "sekoto",
              "tunglur",
              "krecek",
              "blaru",
            ],
            Grogol: [
              "Grogol",
              "kalipang",
              "cerme",
              "wonosari",
              "sonorejo",
              "datengan",
              "sumberejo",
              "gamyok",
              "bakalan",
            ],
            Kandangan: [
              "kemiri",
              "klampisan",
              "karangtengah",
              "kasreman",
              "jerukwangi",
              "jerukgulung",
              "jlumbang",
              "bukur",
              "kandangan",
              "banaran",
              "mlancu",
              "medowo",
            ],
            Mojoroto: [
              "Mojoroto",
              "bandar lor",
              "bandar kidul",
              "banjar mlati",
              "pojok",
              "sukorame",
              "bujel",
              "gayam",
              "mrican",
              "dermo",
              "ngampel",
              "mojoroto",
              "campurejo",
              "lirboyo",
              "tamanan",
            ],
            Pesantren: [
              "Pesantren",
              "banaran",
              "bangsal",
              "betet",
              "bawang",
              "blabak",
              "burengan",
              "jamsaren",
              "ketami",
              "ngletih",
              "pakunden",
              "singonegaran",
              "tempurejo",
              "tinalan",
              "tosaren",
            ],
            Plemahan: [
              "Plemahan",
              "lengenharjo",
              "togowangi",
              "mujono",
              "bogo kidul",
              "kayen lor",
              "wonokerto",
              "ngino",
              "sebet",
              "sukoharjo",
              "mojo kerep",
              "bogo kidul",
              "sidomulyo",
              "banjar rejo",
              "payaman",
              "ringen rejo",
            ],
            Puncu: [
              "Puncu",
              "asmorobangun",
              "manggis",
              "gadungan",
              "sidpmulyo",
              "watu gede",
              "wonorejo",
              "sidokerto",
            ],
            Ringinrejo: [
              "Ringinrejo",
              "batuaji",
              "dawung",
              "deyeng",
              "nambakan",
              "purwodadi",
              "sambi",
              "selodono",
              "srikaton",
              "susuhbango",
              "jemekan",
            ],
            Semen: ["Semen", "bulu", "bobang", "titik", "kedak"],
            Tarokan: [
              "Tarokan",
              "blimbing",
              "bulusari",
              "cengkok",
              "jati",
              "kaliboto",
              "kalirong",
              "kedungsari",
              "kerep",
              "kerep",
              "sumberduren",
              "tarokan",
            ],
            Wates: [
              "duwet",
              "tawang",
              "segaran",
              "Tumpukgadungan",
              "pojok",
              "wonorejo",
              "wates",
              "jajar",
              "tunge",
              "tempurejo",
              "plaosan",
              "karanganyar",
              "sumberagung",
              "pagu",
              "joho",
              "silir",
              "janti",
              "sidomulyo",
            ],
            Ngancar: ["Ngancar", "sempu", "kunjang", "manggis", "sugihwaras"],
            Purwoasri: [
              "Purwoasri",
              "dayu",
              "dawuhan",
              "jantok",
              "kempleng",
              "muneng",
              "pandansari",
              "pesing",
              "sumberejo",
            ],
            Papar: [
              "babad",
              "klanderan",
              "kedungfong",
              "kedungrejo",
              "kwaron",
              "manggis",
              "mekikis",
              "minggiran",
              "ngampel",
              "panjaran",
              "papar",
              "pehkulon",
              "pehwetan",
              "purwotengah",
              "sendangrejo",
            ],
          },
          "Kabupaten Malang": {
            "Kecamatan Lawang": [
              "Desa Sidodadi",
              "Desa Sumberporong",
              "Desa Turirejo",
            ],
            "Kecamatan Kepanjen": [
              "Desa Talangagung",
              "Desa Kedungpedaringan",
              "Desa Panggungrejo",
            ],
          },
          "Kabupaten Blitar": {
            "Kecamatan Kanigoro": [
              "Desa Jatinom",
              "Desa Plosorejo",
              "Desa Gaprang",
            ],
            "Kecamatan Srengat": [
              "Desa Dandong",
              "Desa Kauman",
              "Desa Kuningan",
            ],
          },
          "Kota Kediri": {
            "Kecamatan Mojoroto": [
              "Kelurahan Mojoroto",
              "Kelurahan Campurejo",
              "Kelurahan Sukorame",
            ],
            "Kecamatan Kota": [
              "Kelurahan Dandangan",
              "Kelurahan Balowerti",
              "Kelurahan Jagalan",
            ],
            "Kecamatan Pesantren": [
              "Kelurahan Bangsal",
              "Kelurahan Tempurejo",
              "Kelurahan Burengan",
            ],
          },
          "Kabupaten Tulungagung": {
            "Kecamatan Ngunut": [
              "Desa Ngunut",
              "Desa Sumbergempol",
              "Desa Karangrejo",
            ],
            "Kecamatan Boyolangu": [
              "Desa Beji",
              "Desa Bolorejo",
              "Desa Ketanon",
            ],
          },
          "Kabupaten Jombang": {
            "Kecamatan Diwek": ["Desa Cukir", "Desa Gondek", "Desa Jatipelem"],
            "Kecamatan Mojowarno": [
              "Desa Mojojejer",
              "Desa Japanan",
              "Desa Selorejo",
            ],
          },
          "Kabupaten Nganjuk": {
            "Kecamatan Kertosono": [
              "Desa Banaran",
              "Desa Pandantoyo",
              "Desa Pelem",
            ],
            "Kecamatan Baron": [
              "Desa Baron",
              "Desa Kedungmlati",
              "Desa Sekarputih",
            ],
          },
          "Kabupaten Mojokerto": {
            "Kecamatan Dlanggu": [
              "Desa Randugenengan",
              "Desa Sumberkarang",
              "Desa Pohkecik",
            ],
            "Kecamatan Pacet": [
              "Desa Cempokolimo",
              "Desa Sajen",
              "Desa Claket",
            ],
          },
          "Kabupaten Sidoarjo": {
            "Kecamatan Tanggulangin": [
              "Desa Ketegan",
              "Desa Kedensari",
              "Desa Kludan",
            ],
            "Kecamatan Candi": ["Desa Gelam", "Desa Sugihwaras", "Desa Candi"],
          },
          "Kabupaten Pasuruan": {
            "Kecamatan Pandaan": [
              "Desa Petungasri",
              "Desa Durensewu",
              "Desa Sumbergedang",
            ],
            "Kecamatan Grati": [
              "Desa Ranu Klindungan",
              "Desa Kalipang",
              "Desa Plososari",
            ],
          },
          "Kabupaten Probolinggo": {
            "Kecamatan Leces": [
              "Desa Tigasan Wetan",
              "Desa Sumberkedawung",
              "Desa Warujinggo",
            ],
            "Kecamatan Sukapura": [
              "Desa Ngadisari",
              "Desa Wonokerto",
              "Desa Jetak",
            ],
          },
          "Kabupaten Banyuwangi": {
            "Kecamatan Rogojampi": [
              "Desa Gitik",
              "Desa Bubuk",
              "Desa Lemahbang Dewo",
            ],
            "Kecamatan Genteng": [
              "Desa Genteng Kulon",
              "Desa Genteng Wetan",
              "Desa Setail",
            ],
          },
          "Kabupaten Lamongan": {
            "Kecamatan Babat": [
              "Desa Kebalan Kulon",
              "Desa Moropelang",
              "Desa Plaosan",
            ],
            "Kecamatan Paciran": [
              "Desa Kranji",
              "Desa Weru",
              "Desa Banjarwati",
            ],
          },
        },
        "Jawa Tengah": {},
        "Jawa Barat": {},
        "DKI Jakarta": {},
        Banten: {},
        "Daerah Istimewa Yogyakarta": {},
        Bali: {},
        "Nusa Tenggara Barat": {},
        "Nusa Tenggara Timur": {},
        "Kalimantan Timur": {},
        "Kalimantan Selatan": {},
        "Kalimantan Tengah": {},
        "Kalimantan Barat": {},
        "Kalimantan Utara": {},
        "Sulawesi Selatan": {},
        "Sulawesi Utara": {},
        "Sulawesi Tengah": {},
        "Sulawesi Tenggara": {},
        Gorontalo: {},
        "Sulawesi Barat": {},
        Maluku: {},
        "Maluku Utara": {},
        Papua: {},
        "Papua Barat": {},
        "Papua Tengah": {},
        "Papua Pegunungan": {},
        "Papua Selatan": {},
        "Papua Barat Daya": {},
        Aceh: {},
        "Sumatera Utara": {},
        "Sumatera Barat": {},
        Riau: {},
        "Kepulauan Riau": {},
        Jambi: {},
        Bengkulu: {},
        "Sumatera Selatan": {},
        "Kepulauan Bangka Belitung": {},
        Lampung: {},
      };

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        // Hide splash screen after 2 seconds
        setTimeout(() => {
          const splash = document.getElementById("splash");
          splash.style.opacity = "0";
          setTimeout(() => {
            splash.style.display = "none";
          }, 500);
        }, 2000);

        // Populate provinces
        populateProv();

        // Attach event listeners for dynamic progress
        setupProgressListeners();
      });

      // Show/Hide sections
      function showHome() {
        document.getElementById("home").style.display = "block";
        document.getElementById("formSection").style.display = "none";
      }

      function showForm() {
        document.getElementById("home").style.display = "none";
        document.getElementById("formSection").style.display = "block";
        goToStep(1);
      }

      // Form steps
      function goToStep(n) {
        // Hide all steps and remove active class
        for (let i = 1; i <= 4; i++) {
          document.getElementById(`step${i}`).classList.remove("active");
          document.getElementById(`nav${i}`).classList.remove("active");
        }

        // Show current step and add active class
        document.getElementById(`step${n}`).classList.add("active");
        document.getElementById(`nav${n}`).classList.add("active");

        // Update navigation line
        for (let i = 1; i < 4; i++) {
          const line = document.getElementById(`line${i}`);
          if (i < n) {
            line.style.background = "var(--primary-color)";
          } else {
            line.style.background = "#ccc";
          }
        }
      }

      /**
       * Validates all required fields within a given step.
       * @param {number} stepNumber - The step number to validate (1, 2, 3, or 4).
       * @returns {boolean} - True if the step is valid, false otherwise.
       */
      function validateStep(stepNumber) {
        const stepElement = document.getElementById(`step${stepNumber}`);
        const requiredFields = stepElement.querySelectorAll(
          "input[required], select[required], textarea[required]"
        );
        let isValid = true;

        requiredFields.forEach((field) => {
          const errorText = field.parentElement.querySelector(".error-text");
          if (field.type === "radio") {
            const radioGroup = stepElement.querySelectorAll(
              `input[name="${field.name}"]`
            );
            const isChecked = Array.from(radioGroup).some((r) => r.checked);
            if (!isChecked) {
              isValid = false;
              if (errorText) errorText.style.display = "block";
            } else {
              if (errorText) errorText.style.display = "none";
            }
          } else if (!field.value.trim()) {
            field.classList.add("error");
            if (errorText) errorText.style.display = "block";
            isValid = false;
          } else {
            field.classList.remove("error");
            if (errorText) errorText.style.display = "none";
          }
        });

        if (!isValid) {
          showNotification(
            "Mohon lengkapi semua field yang wajib diisi.",
            "error"
          );
        }
        return isValid;
      }

      function nextStep(currentStep) {
        if (validateStep(currentStep)) {
          goToStep(currentStep + 1);
        }
      }

      // Dropdown population
      function populateProv() {
        const provSelect = document.getElementById("provinsi");
        provSelect.innerHTML = "<option value=''>-- Pilih Provinsi --</option>";
        Object.keys(wilayah).forEach((prov) => {
          provSelect.innerHTML += `<option value="${prov}">${prov}</option>`;
        });
      }

      function populateKab() {
        const prov = document.getElementById("provinsi").value;
        const kabSelect = document.getElementById("kabupaten");
        const kecSelect = document.getElementById("kecamatan");
        const desaSelect = document.getElementById("desa");
        kabSelect.innerHTML =
          "<option value=''>-- Pilih Kabupaten/Kota --</option>";
        kecSelect.innerHTML = "<option value=''>-- Pilih Kecamatan --</option>";
        desaSelect.innerHTML = "<option value=''>-- Pilih Desa --</option>";
        if (prov && wilayah[prov]) {
          Object.keys(wilayah[prov]).forEach((kab) => {
            kabSelect.innerHTML += `<option value="${kab}">${kab}</option>`;
          });
        }
      }

      function populateKec() {
        const prov = document.getElementById("provinsi").value;
        const kab = document.getElementById("kabupaten").value;
        const kecSelect = document.getElementById("kecamatan");
        const desaSelect = document.getElementById("desa");
        kecSelect.innerHTML = "<option value=''>-- Pilih Kecamatan --</option>";
        desaSelect.innerHTML = "<option value=''>-- Pilih Desa --</option>";
        if (prov && kab && wilayah[prov][kab]) {
          Object.keys(wilayah[prov][kab]).forEach((kec) => {
            kecSelect.innerHTML += `<option value="${kec}">${kec}</option>`;
          });
        }
      }

      function populateDesa() {
        const prov = document.getElementById("provinsi").value;
        const kab = document.getElementById("kabupaten").value;
        const kec = document.getElementById("kecamatan").value;
        const desaSelect = document.getElementById("desa");
        desaSelect.innerHTML = "<option value=''>-- Pilih Desa --</option>";
        if (prov && kab && kec && wilayah[prov][kab][kec]) {
          wilayah[prov][kab][kec].forEach((desa) => {
            desaSelect.innerHTML += `<option value="${desa}">${desa}</option>`;
          });
        }
      }

      // Toggle institution fields
      function toggleInstitution(type) {
        const checkbox = document.getElementById(`chk_${type}`);
        const fields = document.getElementById(`${type}Fields`);
        if (checkbox.checked) {
          fields.classList.add("show");
        } else {
          fields.classList.remove("show");
        }
      }

      // Image preview
      function previewImage(inputId, previewId) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById(previewId);
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function (e) {
            preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
          };
          reader.readAsDataURL(input.files[0]);
        } else {
          preview.innerHTML = "";
        }
      }

      // Notification system
      function showNotification(message, type = "info", duration = 3000) {
        const container = document.getElementById("notificationContainer");
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        let icon = "";
        switch (type) {
          case "success":
            icon = "fa-check-circle";
            break;
          case "error":
            icon = "fa-exclamation-circle";
            break;
          case "warning":
            icon = "fa-exclamation-triangle";
            break;
          default:
            icon = "fa-info-circle";
        }
        notification.innerHTML = `<i class="fas ${icon}"></i><span>${message}</span><span class="notification-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></span>`;
        container.appendChild(notification);
        setTimeout(() => {
          notification.remove();
        }, duration);
      }

      /**
       * Sets up event listeners to update progress indicators dynamically.
       */
      function setupProgressListeners() {
        for (let i = 1; i <= 4; i++) {
          const stepElement = document.getElementById(`step${i}`);
          const requiredFields = stepElement.querySelectorAll(
            "input[required], select[required], textarea[required]"
          );

          requiredFields.forEach((field) => {
            // Use 'input' for text fields and 'change' for selects/radios
            const eventType =
              field.tagName === "SELECT" ||
              field.type === "radio" ||
              field.type === "checkbox"
                ? "change"
                : "input";
            field.addEventListener(eventType, () => updateStepProgress(i));
          });
        }
      }

      /**
       * Checks if all required fields in a step are filled and updates the UI accordingly.
       * @param {number} stepNumber - The step number to check.
       */
      function updateStepProgress(stepNumber) {
        const stepElement = document.getElementById(`step${stepNumber}`);
        const navElement = document.getElementById(`nav${stepNumber}`);
        const requiredFields = stepElement.querySelectorAll(
          "input[required], select[required], textarea[required]"
        );

        let isComplete = true;
        requiredFields.forEach((field) => {
          if (field.type === "radio") {
            const radioGroup = stepElement.querySelectorAll(
              `input[name="${field.name}"]`
            );
            if (!Array.from(radioGroup).some((r) => r.checked)) {
              isComplete = false;
            }
          } else if (!field.value.trim()) {
            isComplete = false;
          }
        });

        if (isComplete) {
          navElement.classList.add("completed");
        } else {
          navElement.classList.remove("completed");
        }
      }

      // Form submission
      async function submitForm() {
        let isFormValid = true;
        // Validate all steps before submission
        for (let i = 1; i <= 4; i++) {
          if (!validateStep(i)) {
            isFormValid = false;
            goToStep(i); // Go to the first invalid step
            break; // Stop checking further
          }
        }

        if (!isFormValid) {
          return; // Stop submission if validation fails
        }

        // Prepare form data (same as before)
        const formData = new FormData();
        formData.append("nik", document.getElementById("nik").value);
        formData.append("email", document.getElementById("email").value);
        formData.append("nama", document.getElementById("nama").value);
        formData.append(
          "tempat_lahir",
          document.getElementById("tempat_lahir").value
        );
        formData.append(
          "tanggal_lahir",
          document.getElementById("tanggal_lahir").value
        );
        formData.append("jk", document.getElementById("jk").value);
        formData.append("hp", document.getElementById("hp").value);
        formData.append(
          "nama_pelatih",
          document.getElementById("nama_pelatih").value
        );
        formData.append(
          "lokasi_latihan",
          document.getElementById("lokasi_latihan").value
        );
        formData.append("provinsi", document.getElementById("provinsi").value);
        formData.append(
          "kabupaten",
          document.getElementById("kabupaten").value
        );
        formData.append(
          "kecamatan",
          document.getElementById("kecamatan").value
        );
        formData.append("desa", document.getElementById("desa").value);

        if (document.getElementById("chk_padepokan").checked) {
          formData.append(
            "padepokan_nama",
            document.getElementById("nama_padepokan").value
          );
          formData.append(
            "padepokan_pengasuh",
            document.getElementById("pengasuh_padepokan").value
          );
          formData.append(
            "padepokan_telepon",
            document.getElementById("telepon_padepokan").value
          );
          formData.append(
            "padepokan_alamat",
            document.getElementById("alamat_padepokan").value
          );
        }

        if (document.getElementById("chk_pesantren").checked) {
          formData.append(
            "pesantren_nama",
            document.getElementById("nama_pesantren").value
          );
          formData.append(
            "pesantren_pengasuh",
            document.getElementById("pengasuh_pesantren").value
          );
          formData.append(
            "pesantren_telepon",
            document.getElementById("telepon_pesantren").value
          );
          formData.append(
            "pesantren_alamat",
            document.getElementById("alamat_pesantren").value
          );
        }

        if (document.getElementById("chk_sekolah").checked) {
          formData.append(
            "sekolah_nama",
            document.getElementById("nama_sekolah").value
          );
          formData.append(
            "sekolah_alamat",
            document.getElementById("alamat_sekolah").value
          );
          formData.append(
            "sekolah_telepon",
            document.getElementById("telepon_sekolah").value
          );
        }

        const pengurusRadio = document.querySelector(
          'input[name="pengurus"]:checked'
        );
        if (pengurusRadio) {
          formData.append("pengurus", pengurusRadio.value);
        }

        const fotoFile = document.getElementById("foto").files[0];
        const ktpFile = document.getElementById("ktp").files[0];
        formData.append("foto", fotoFile);
        formData.append("ktp", ktpFile);

        try {
          showNotification("Mengirim data...", "info", 10000);
          const response = await fetch(
            "https://script.google.com/macros/s/AKfycbzzcYhwLyKmzV9sqCSskzawbbNyIzX2iLoDsEFqxwJxNQvN53bURw5m1llHpe3dUrW5yA/exec",
            { method: "POST", body: formData }
          );
          const result = await response.json();

          if (result.result === "success") {
            showNotification(
              "Data berhasil dikirim! Tunggu verifikasi dari admin.",
              "success"
            );
            // Reset form and go to home
            document.getElementById("regForm").reset();
            document.getElementById("previewFoto").innerHTML = "";
            document.getElementById("previewKTP").innerHTML = "";
            ["padepokanFields", "pesantrenFields", "sekolahFields"].forEach(
              (id) => {
                document.getElementById(id).classList.remove("show");
              }
            );
            // Reset progress indicators
            for (let i = 1; i <= 4; i++) {
              document.getElementById(`nav${i}`).classList.remove("completed");
            }
            setTimeout(() => {
              showHome();
            }, 3000);
          } else if (result.result === "duplicate") {
            showNotification("NIK sudah terdaftar dalam sistem!", "warning");
          } else {
            showNotification(
              "Terjadi kesalahan: " + JSON.stringify(result),
              "error"
            );
          }
        } catch (error) {
          showNotification("Gagal mengirim data: " + error.message, "error");
        }
      }
    </script>
  </body>
</html>
